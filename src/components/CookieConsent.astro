<script type="module">
  import * as CookieConsent from 'vanilla-cookieconsent';
  import { config } from './CookieConsentConfig';
  import { initGA, grantAnalyticsConsent } from '../ga';

  document.body.classList.add('cc--elegant-black');

  // (optional) fÃ¼r DevTools
  window.CookieConsent = CookieConsent;

  CookieConsent.run({
    ...config,
    guiOptions: {
      ...config.guiOptions,
      consentModal: {
        ...config.guiOptions?.consentModal,
        position: 'bottom center', // WICHTIG: nicht "middle"
      },
    },
  });

  // falls noch kein Consent existiert, Banner erzwingen
  if (!CookieConsent.validConsent()) {
    CookieConsent.show(true);
  }

  // bereits erteilte Zustimmung respektieren (nur Prod)
  if (import.meta.env.PROD) {
    const prefs = CookieConsent.getUserPreferences?.() || {};
    const cats = prefs.acceptedCategories || [];
    const services = Object.values(prefs.acceptedServices || {}).flat();

    if (cats.includes('analytics') || services.includes('ga4')) {
      const MID = import.meta.env.PUBLIC_GA_MEASUREMENT_ID;
      initGA(MID);
      grantAnalyticsConsent();
      window.gtag?.('event', 'page_view', {
        page_location: location.href,
        page_path: location.pathname,
        page_title: document.title,
      });
    }
  }

  // Debug-Helfer:
  // window.ccReset = () => CookieConsent.reset(true);
  // window.ccShow  = () => CookieConsent.show(true);
</script>
