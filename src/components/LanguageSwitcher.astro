---
import { getCollection } from 'astro:content';

const lang = Astro.props.lang ?? (Astro.url.pathname.startsWith('/en') ? 'en' : 'de');
const groupId = Astro.props.groupId;

// Standard-Link & Sichtbarkeiten
let switchLink = '';
let showGerman = true;
let showEnglish = true;

const isProject = Astro.url.pathname.includes('/projects/');
const collection = isProject ? 'projects' : 'blog';

if (groupId) {
  const entries = await getCollection(collection);
  const otherLang = lang === 'de' ? 'en' : 'de';

  const otherPost = entries.find(
    (p) => (p.data.groupId ?? p.id) === groupId && p.data.lang === otherLang
  );

  switchLink = otherPost
    ? (lang === 'de'
        ? `/en/${collection}/${otherPost.id}/`
        : `/${collection}/${otherPost.id}/`)
    : '';

  if (!otherPost) {
    if (lang === 'de') showEnglish = false;
    if (lang === 'en') showGerman = false;
  }
} else {
  // Kein groupId = normale Seite wie Start, About, etc.
  switchLink =
    lang === 'de'
      ? '/en' + Astro.url.pathname
      : Astro.url.pathname.replace(/^\/en/, '') || '/';
}
---


<div class="language-switcher">
  <details>
    <summary>
      <span aria-label={lang === 'en' ? "English" : "Deutsch"}>
        {lang === 'en' ? "ðŸ‡¬ðŸ‡§" : "ðŸ‡©ðŸ‡ª"}
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
          <path fill="#fff" d="M233.4 406.6c12.5 12.5 32.8 12.5 45.3 0l192-192c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L256 338.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l192 192z"/>
        </svg>
      </span>
    </summary>
    <ul>
      <li>
        {lang === 'de' ? (
          <span class="lang-active">ðŸ‡©ðŸ‡ª Deutsch</span>
        ) : showGerman ? (
          <a class="lang-link" href={switchLink}>ðŸ‡©ðŸ‡ª Deutsch</a>
        ) : (
          <span class="lang-disabled">ðŸ‡©ðŸ‡ª Deutsch</span>
        )}
      </li>
      <li>
        {lang === 'en' ? (
          <span class="lang-active">ðŸ‡¬ðŸ‡§ English</span>
        ) : showEnglish ? (
          <a class="lang-link" href={switchLink}>ðŸ‡¬ðŸ‡§ English</a>
        ) : (
          <span class="lang-disabled">ðŸ‡¬ðŸ‡§ English</span>
        )}
      </li>
    </ul>
  </details>
</div>




<style lang="scss">
  .language-switcher {
    position: relative;
    font-size: 1rem;
  }
  .language-switcher .inactive {
    opacity: 0.6;
    pointer-events: none;
    cursor: default;
    text-decoration: none;
  }

.language-switcher summary {
  list-style: none;
  cursor: pointer;
  background: none;
  font-size: 1.5rem;
  display: flex;
  align-items: center;
  padding: 0 0.5rem;
  border: #fff 3px solid;
  border-radius: 0.4em;
  line-height: 2rem;

    svg{
        width: 1.3rem;
    }
}

.language-switcher summary::-webkit-details-marker {
  display: none;
}

.language-switcher ul {
  position: absolute;
  z-index: 1003;
  width: 7rem;
  top: 100%;
  right: 0;
  margin: 0;
  padding: 0.25rem 0.5rem;
  list-style: none;
  background: white;
  border: 1px solid #ccc;
  border-radius: 16px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.language-switcher li {
  margin: 0;
}

.language-switcher a, .language-switcher li span {
  text-decoration: none;
  color: #222;
  display: block;
  padding: 0.25rem 0.5rem;
  transition: background 0.2s ease;
}

.language-switcher a:hover {
  background: #f0f0f0;
}

.language-switcher .lang-disabled {
opacity: 0.5;
cursor: not-allowed;
}
</style>
